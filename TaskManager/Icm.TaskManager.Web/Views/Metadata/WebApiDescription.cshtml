@model IEnumerable<Icm.TaskManager.Web.Controllers.MetadataController.ApiMethodModel>
<script type="text/javascript">
    var taskmanager = taskmanager || {};

    taskmanager.api = {
        metadata: @Html.Raw(Json.Encode(Model))
        };

    $.each(taskmanager.api.metadata, function (i, action) {
        if (!taskmanager.api[action.ControllerName]) {
            taskmanager.api[action.ControllerName] = {};
        }
        taskmanager.api[action.ControllerName][action.ActionName] = function (parameters) {
            var url = '/' + action.Url;
            var data;
            $.each(action.Parameters, function (j, parameter) {
                if (parameters[parameter.Name] === undefined) {
                    console.log('Missing parameter: ' + parameter.Name + ' for API: ' + action.ControllerName + '/' + action.ActionName);
                } else if (parameter.IsUriParameter) {
                    url = url.replace("{" + parameter.Name + "}", parameters[parameter.Name]);
                } else if (data === undefined) {
                    data = parameters[parameter.Name];
                } else {
                    console.log('Detected multiple body-parameters for API: ' + action.ControllerName + '/' + action.ActionName);
                }
            });
            return $.ajax({
                type: action.Method,
                url: url,
                data: data,
                contentType: 'application/json'
            });
        };
    });
</script>
